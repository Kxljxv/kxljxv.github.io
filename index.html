<script>
    var map = L.map('map').setView([52.52, 13.40], 12); // Berlin als Zentrum
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Farben für die Parteien (skaliert von weiß bis rot)
    function getPartyColor(value) {
        // Wert zwischen 0 und 1 umwandeln in eine Farbe
        var red = Math.min(255, Math.max(0, Math.floor(value * 255))); // Skaliert von 0 bis 255
        return `rgb(${red}, ${255 - red}, ${255 - red})`; // Farbübergang von weiß nach rot
    }

    // Die aktuelle Partei, die angezeigt werden soll
    var currentParty = "SPDinkBW";

    // GeoJSON-Daten laden und zur Karte hinzufügen
    fetch('https://kxljxv.github.io/wahlergebnisse.json')
        .then(response => response.json())
        .then(data => {
            // Stil für die GeoJSON-Polygone
            function style(feature) {
                var value = parseFloat(feature.properties[currentParty].replace(',', '.')); // Wert aus der GeoJSON
                return {
                    fillColor: getPartyColor(value),  // Färbe die Polygon nach Wert
                    weight: 0,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            }

            // Funktion für das Popup mit Informationen
            function onEachFeature(feature, layer) {
                layer.on('mouseover', function (e) {
                    var popupContent = '<b>' + feature.properties.Bezirk + '</b><br>' +
                        'Wahlbeteiligung: ' + (parseFloat(feature.properties.WahlbeteiligunginkBW.replace(',', '.')) * 100).toFixed(2) + '%<br>' +
                        feature.properties[currentParty] + ' der Partei: ' + currentParty + '<br>';
                    layer.bindPopup(popupContent).openPopup();
                });
            }

            L.geoJSON(data, { style: style, onEachFeature: onEachFeature }).addTo(map);
        })
        .catch(error => console.error('Fehler beim Laden der GeoJSON-Daten:', error));

    // Event listener für die Auswahl der Partei
    document.getElementById('partySelect').addEventListener('change', function (e) {
        currentParty = e.target.value;
        // Alle Polygone mit der neuen Partei aktualisieren
        map.eachLayer(function (layer) {
            if (layer instanceof L.GeoJSON) {
                layer.setStyle(style(layer.feature));
            }
        });
    });

    // Fancy Schieberegler für den Vergleich der Wahlergebnisse
    var slider = document.getElementById('slider');
    noUiSlider.create(slider, {
        start: [0],
        range: {
            'min': [0],
            'max': [1]  // Slider von 0 bis 1 für Wahlergebnisse
        },
        step: 0.01, // Schrittweite
        connect: [true, false],
        format: {
            to: function (value) {
                return value.toFixed(2); // Formatierung auf 2 Dezimalstellen
            },
            from: function (value) {
                return value;
            }
        }
    });

    slider.noUiSlider.on('update', function (values, handle) {
        var percentage = values[handle];
        // Hier könntest du zusätzliche Logik hinzufügen, um etwas mit dem Schieberegler zu machen
        console.log('Slider Value: ' + percentage);
    });
</script>
