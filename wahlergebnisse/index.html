<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Berlin Wahlergebnisse</title>
    <link href='https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        #map-container {
            display: flex;
            height: 100vh;
            transition: all 0.3s ease;
        }
        #map {
            flex-grow: 1;
            position: relative;
        }
        #chart-container {
            width: 0;
            transition: width 0.3s ease;
            overflow: hidden;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
        }
        #chart-info {
            padding: 10px;
            text-align: center;
            background-color: #f8f8f8;
        }
        #chart {
            flex-grow: 1;
            padding: 10px;
        }
        .landscape-mode {
            flex-direction: row;
        }
        .portrait-mode {
            flex-direction: column;
        }
        #chart-container.visible {
            width: 400px;
        }
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px;
            border-radius: 3px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
        <div id="chart-container">
            <div id="chart-info"></div>
            <div id="chart"></div>
        </div>
    </div>

    <script src='https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
    <script>
        // Configuration object
        const CONFIG = {
            // Colors and styling configurations will be added here
            colorMappings: {
                // Placeholder for party and result color configurations
            },
            berlinAverages: {
                // Placeholder for Berlin-wide average results
            }
        };

        // Main application class
        class BerlinElectionMap {
            constructor(options) {
                this.options = options;
                this.mapContainer = document.getElementById('map-container');
                this.chartContainer = document.getElementById('chart-container');
                this.chartInfo = document.getElementById('chart-info');
                this.chartElement = document.getElementById('chart');
                this.currentChart = null;
                
                this.initializeMap();
                this.loadData();
            }

            async loadData() {
                try {
                    const [mapData, resultsData] = await Promise.all([
                        fetch('https://kxljxv.github.io/wahlergebnisse/map.json').then(r => r.json()),
                        fetch('https://kxljxv.github.io/wahlergebnisse/ergebnisse.csv').then(r => r.text())
                    ]);

                    // Parse CSV (this would require a CSV parsing library)
                    // For simplicity, I'm leaving this as a placeholder
                    this.mapData = mapData;
                    this.resultsData = resultsData;

                    this.setupMap(mapData);
                } catch (error) {
                    console.error('Data loading error:', error);
                }
            }

            initializeMap() {
                this.map = new maplibregl.Map({
                    container: 'map',
                    style: 'https://kxljxv.github.io/bm_web_gry_7.json',
                    center: [13.404954, 52.520008],
                    zoom: 9
                });

                // Add navigation and location controls
                this.map.addControl(new maplibregl.NavigationControl());
                this.map.addControl(new maplibregl.GeolocateControl({
                    positionOptions: {
                        enableHighAccuracy: true
                    },
                    trackUserLocation: true
                }));
            }

            setupMap(mapData) {
                // Map setup logic for election results visualization
                // This would involve adding layers, handling interactions, etc.
            }

            updateVisualization(year, resultType) {
                // Logic to update map colors and chart based on selection
            }

            renderChart(districtData) {
                // Render election results chart
            }

            toggleMode(mode) {
                this.mapContainer.classList.remove('landscape-mode', 'portrait-mode');
                this.mapContainer.classList.add(`${mode}-mode`);
            }
        }

        // Initialization function
        function initElectionMap(options) {
            return new BerlinElectionMap(options);
        }

        // Example usage
        document.addEventListener('DOMContentLoaded', () => {
            const map = initElectionMap({
                year: '2025',
                resultType: 'gewinner',
                mode: 'landscape'
            });
        });
    </script>
</body>
</html>
