<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wahlergebnisse Berlin</title>
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #map { width: 100%; height: 500px; }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center p-6">
    <h1 class="text-3xl font-bold mb-6">Wahlergebnisse Berlin</h1>
    
    <div id="mapContainer" class="w-4/5 mb-6">
        <div id="map" class="rounded-xl shadow-lg"></div>
    </div>
    
    <div id="resultsContainer" class="w-4/5 my-6 p-4 bg-white rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold mb-4">Wahlergebnisse</h2>
        <table class="min-w-full table-auto text-left border-collapse">
            <thead>
                <tr>
                    <th class="px-4 py-2 border-b">Urnenwahlbezirk</th>
                    <th class="px-4 py-2 border-b">Wahlbeteiligung</th>
                    <th class="px-4 py-2 border-b">Ergebnis</th>
                </tr>
            </thead>
            <tbody id="resultsTableBody">
                <!-- Inhalte werden per JavaScript eingefÃ¼gt -->
            </tbody>
        </table>
    </div>

    <div class="w-4/5 my-6 p-4 bg-white rounded-xl shadow-lg">
        <h2 class="text-2xl font-bold mb-4">Ergebnisdiagramm</h2>
        <canvas id="resultsChart"></canvas>
    </div>
    
    <script>
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://demotiles.maplibre.org/style.json',
            center: [13.4050, 52.5200],
            zoom: 10
        });

        function updateResultsTable(features) {
            const tableBody = document.getElementById('resultsTableBody');
            tableBody.innerHTML = '';
            const chartLabels = [];
            const chartData = [];

            features.forEach(function(feature) {
                const rawValue = parseFloat(feature.properties.Ergebnis.replace(',', '.'));
                const percent = (rawValue * 100).toFixed(2) + '%';
                const turnout = (parseFloat(feature.properties.Wahlbeteiligung.replace(',', '.')) * 100).toFixed(2) + '%';

                const row = document.createElement('tr');
                row.className = 'border-b';
                row.innerHTML = `
                    <td class="px-4 py-2">${feature.properties.UWB}</td>
                    <td class="px-4 py-2">${turnout}</td>
                    <td class="px-4 py-2">${percent}</td>
                `;
                tableBody.appendChild(row);
                
                chartLabels.push(feature.properties.UWB);
                chartData.push(rawValue * 100);
            });
            updateChart(chartLabels, chartData);
        }

        function updateChart(labels, data) {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Wahlergebnis (%)',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        map.on('click', function(e) {
            const features = [{
                properties: {
                    UWB: 'Wahlbezirk ' + Math.floor(Math.random() * 100),
                    Wahlbeteiligung: (Math.random() * 0.5 + 0.5).toFixed(2),
                    Ergebnis: (Math.random() * 0.5).toFixed(2)
                }
            }];
            updateResultsTable(features);
        });
    </script>
</body>
</html>
